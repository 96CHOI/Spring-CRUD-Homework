<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CRUD! ğŸ˜›</title>
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <div class="container">
    <!-- ë¶€ì„œ ì¶”ê°€ íŒì—… -->
    <div class="write-popup">
      <div class="editor">
        <div class="input-box">
          <label>ê³¼ì • ë²ˆí˜¸ : </label>
          <input id="add-ProcessNum" type="number" placeholder="ê³¼ì •ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." />
        </div>
        <div class="input-box">
          <label>ê³¼ì • ëª… : </label>
          <input id="add-ProcessName" type="text" placeholder="ê³¼ì •ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..." />
        </div>
        <div class="input-box">
          <label>ê³¼ì • í˜¸ì‹¤ : </label>
          <input id="add-ProcessRoom" type="text" placeholder="ê³¼ì •í˜¸ì‹¤ì„ ì…ë ¥í•˜ì„¸ìš”..." />
        </div>
        <div class="input-box">
          <label>ê³¼ì • ê¸°ê°„ : </label>
          <input id="add-ProcessStartdate" type="date" placeholder="ê³¼ì • ì‹œì‘ ë‚ ì§œì…ë ¥..." />
          <input id="add-ProcessEnddate" type="date" placeholder="ê³¼ì • ì¢…ë£Œ ë‚ ì§œì…ë ¥..." />
        </div>
        <div class="input-box">
          <label>ë‹´ë‹¹ êµì‚¬ : </label>
          <input id="add-TeacherName" type="text" placeholder="êµì‚¬ì´ë¦„ ì…ë ¥í•˜ì„¸ìš”..." />
        </div>
        <div class="btn-area">
          <a href="#" class="btn-cancel" onclick="">ì·¨ì†Œ</a>
          <a href="#" class="btn-success" onclick="processAdd()">ë“±ë¡</a>
        </div>
      </div>
    </div>
    <!-- ë¶€ì„œ ìˆ˜ì • -->
    <div class="update-popup">
      <div class="editor">
        <div class="close">
          <a href="#" class="btn-close">ë‹«ê¸°</a>
        </div>
        <div class="input-box">
          <label>ê³¼ì • ë²ˆí˜¸ : </label>
          <input id="update-processNum" type="number" disabled="disabled" readonly/>
        </div>
        <div class="input-box">
          <label>ê³¼ì • ëª… : </label>
          <input id="update-processName" type="text"/>
        </div>
        <div class="input-box">
          <label>ê³¼ì • í˜¸ì‹¤ : </label>
          <input id="update-processRoom" type="text"/>
        </div>
        <div class="input-box">
          <label>ê³¼ì • ê¸°ê°„ : </label>
          <input id="update-processStartdate" type="date"/>
          <input id="update-processEnddate" type="date"/>
        </div>
        <div class="input-box">
          <label>ë‹´ë‹¹ êµì‚¬ : </label>
          <input id="update-teacherName" type="text"/>
        </div>
        <div class="btn-area">
          <a href="#" class="btn-update" onclick="doUpdate()">ìˆ˜ì •</a>
          <a href="#" class="btn-delete" onclick="doDelete()">ì‚­ì œ</a>
        </div>
      </div>
    </div>
    <div class="navigation">
      <ul>
        <li>
          <a href="#">
            <span class="icon"><ion-icon name="logo-apple"></ion-icon></span>
            <span class="title">DW ADMIN</span>
          </a>
        </li>
        <li>
          <a href="./student">
            <span class="icon"><ion-icon name="home-outline"></ion-icon></span>
            <span class="title">í•™ìƒ ëª©ë¡</span>
          </a>
        </li>
        <li>
          <a href="./process">
            <span class="icon"><ion-icon name="person-outline"></ion-icon></span>
            <span class="title">ê³¼ì • ëª©ë¡</span>
          </a>
        </li>
        <!-- <li>
            <a href="#">
              <span class="icon"><ion-icon name="log-out-outline"></ion-icon></span>
              <span class="title">Sign Out</span>
            </a>
          </li> -->
      </ul>
    </div>
  </div>
  <!-- main -->
  <div class="main">
    <!-- table -->
    <div class="details">
      <div class="recentOrders">
        <div class="cardHeader">
          <h2>ê³¼ì • ëª©ë¡</h2>
          <a href="#" onclick="addSubject()" class="btn">ê³¼ì • ì¶”ê°€</a>
        </div>
        <table>
          <thead>
            <tr>
              <th>ê³¼ì • ë²ˆí˜¸</th>
              <th>ê³¼ì • ì´ë¦„</th>
              <th>ê³¼ì • í˜¸ì‹¤</th>
              <th>ê³¼ì • ê¸°ê°„</th>
              <th>ë‹´ë‹¹ êµì‚¬</th>
            </tr>
          </thead>
          <tbody id="data"></tbody>
        </table>
        <!-- í˜ì´ì§• ì²˜ë¦¬í•˜ëŠ” HTML -->
        <div class="pagination">
          <a>Previous</a>
          <a>1</a>
          <a>2</a>
          <a>3</a>
          <a>4</a>
          <a>5</a>
          <a>Next</a>
        </div>
      </div>
    </div>
  </div>
</body>
<!-- Icon CDN -->
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
<!-- Jquery CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script>
  // ê³¼ì • ëª©ë¡ í˜ì´ì§€ í…Œì´ë¸” ìƒì„± ë° ì „ì²´ ì¡°íšŒ
  $.ajax({
    url: '/api/v1/process',
    type: 'GET',
    dataType: 'json',
    success: function (response) {
      for (var i = 0; i < response.length; i++) {
        // tr = $('<tr onclick="getData(' + response[i].studentNum + ')"></tr>');
        tr = $('<tr onclick="getProcess(' + response[i].processNum + ')"></tr>');
        processNum = $('<td>' + response[i].processNum + '</td>');
        processName = $('<td>' + response[i].processName + '</td>');
        processRoom = $('<td>' + response[i].processRoom + '</td>');
        processDate = $('<td>' + response[i].processStartdate + '~' + response[i].processEnddate + '</td>');
        teacherName = $('<td>' + response[i].teacherName + '</td>');
        tr.append(processNum);
        tr.append($('<td>' + response[i].processName + '</td>'));
        tr.append(processRoom);
        tr.append(processDate);
        tr.append(teacherName);
        $('#data').append(tr);
      }
    },
  });
  // ê³¼ì • ìƒì„¸ì •ë³´ íŒì—…ì°½
  function getProcess(processNum) {
    $('.update-popup').css('display', 'block');
    $.ajax({
      url: '/process/' + processNum,
      type: 'GET',
      dataType: 'json',
      success: function (response) {
        $('#update-processNum').val(response.processNum);
        $('#update-processName').val(response.processName);
        $('#update-processRoom').val(response.processRoom);
        $('#update-processStartdate').val(response.processStartdate);
        $('#update-processEnddate').val(response.processEnddate);
        $('#update-teacherName').val(response.teacherName);
      },
    });
  }

  // ê³¼ì • ëª©ë¡ ì¶”ê°€
  function processAdd() {
    var num = $("#add-processNum").val();
    var name = $("#add-processName").val();
    var processRoom = $("#add-processRoom").val();
    var startdate = $("#add-processStartdate").val();
    var enddate = $("#add-processEnddate").val();
    var teacherName = $('#add-teacherName').val();

    var jsonData = {
      processNum: num,
      processName: name,
      processRoom: processRoom,
      processStartdate: startdate,
      processEnddate: enddate,
      teacherName: teacherName
    };

    $.ajax({
      url: '/api/v1/processInsert',
      type: 'POST',
      contentType: 'application/json', //ì„œë²„ì— json íƒ€ì…ìœ¼ë¡œ ë³´ë‚¼ ì˜ˆì •(ìš”ì²­)
      data: JSON.stringify(jsonData),
      dataType: 'json',
      success: function (response) {
        console.log(response);
        alert('ê³¼ì • ë“±ë¡ ì™„ë£Œ');
        location.reload();
      },
    });
  }
  //ê³¼ì •ëª©ë¡ ìˆ˜ì •
  function doUpdate() {
    var num = $("#update-processNum").val();
    var name = $("#update-processName").val();
    var processRoom = $("#update-processRoom").val();
    var startdate = $("#update-processStartdate").val();
    var enddate = $("#update-processEnddate").val();
    var teacherName = $('#update-teacherName').val();

    var jsonData = {
      processNum: num,
      processName: name,
      processRoom: processRoom,
      processStartdate: startdate,
      processEnddate: enddate,
      teacherName: teacherName
    };

    $.ajax({
      url: '/process',
      type: 'PATCH',
      contentType: 'application/json', //ì„œë²„ì— json íƒ€ì…ìœ¼ë¡œ ë³´ë‚¼ ì˜ˆì •(ìš”ì²­)
      data: JSON.stringify(jsonData),
      dataType: 'json',
      success: function (response) {
        console.log(response);
        alert('ê³¼ì • ì •ë³´ ìˆ˜ì • ì™„ë£Œ');
        location.reload(); //ê°•ì œ ìƒˆë¡œê³ ì¹¨
      },
    });
  }

  //ê³¼ì • ëª©ë¡ ì‚­ì œ
  function doDelete() {
    var num = $("#update-processNum").val();

    $.ajax({
      url: '/process/' + num,
      type: 'DELETE',
      dataType: 'json',
      success: function (response) {
        alert('ê³¼ì •ëª©ë¡ ì‚­ì œ ì™„ë£Œ!âœ‹âœ‹');
        location.reload(); //ê°•ì œ ìƒˆë¡œê³ ì¹¨
      },
    });
  }


  $('.btn-cancel').click(function () {
    $('.write-popup').css('display', 'none');
  });
  $('.btn-close').click(function () {
    $('.update-popup').css('display', 'none');
  });
  let list = document.querySelectorAll('.navigation li');
  function activeLink() {
    list.forEach((item) => {
      item.classList.remove('hovered');
    });
    this.classList.add('hovered');
  }
  list.forEach((item) => {
    item.addEventListener('mouseover', activeLink);
  });

  function getSubject() {
    $('.update-popup').css('display', 'block');
  }

  function addSubject() {
    $('.write-popup').css('display', 'block');
  }
</script>

</html>